淘书屋二期需求确认书
===

### 需求描述

一期项目是一个基于微信访问的供大学校园使用的二手书交易平台，在此基础上客户需要增加新书订购的系统。现有订购流程如下：

1. 公司中标对某个学校当前年度的所有书本进行供应
2. 学校提供所有书本的采购信息，包括名称、作者、出版社、ISBN、教师用书数量、主讲教师、对应课程、上课班级、校区等信息
3. 采购完所有书本，开学的时候把书本送到教务处，通知班长领书、班长再发放到各个寝室。教师用书由教务处发给老师
4. 学校结款


在现有流程中存在以下几个问题：

1. 每年会有不少的书本退回，造成物流成本浪费
2. 书本结款滞后，资金到位不及时

淘书屋二期帮助人们实现以下几个功能：

1. 书本订购由学生本人完成，需要订二手书或者新书都可以在平台上完成
2. 书本款项在送书前就进入公司账户中
3. 采购书本统计更加准确

### 业务流程描述

1. 导入教材信息，根据 ISBN 接口进行核对
2. 管理员录入学校、学院、班级信息
3. 管理员关联班级和教材，一本教材可以对应多个班级，一个班级可以有多本教材
4. 管理员添加一个订购年度，设定订购时间，订购年度与学校关联，一个学校拥有多个订购年度，没有可用订购年度将不能下单
5. 会员注册之后选择所在学校、学院、班级（类似于工管171）
6. 会员在指定时间之内完成订书，仅有所在班级关联的教材可购买
7. 后台管理员可根据学校形成教材数量的统计表，横向为教材条目，纵向包括书名、订书数量等
8. 会员可查看自己所在班级的订书统计表，用于班级取书
9. 会员可查看个人订书统计表，用于核对

### 系统概要设计

根据业务流程，系统中应该存在以下模块：

1. 学校管理模块——用于维护学校信息
2. 班级管理模块——用于维护学院、班级信息，建立班级与用户之间的关系
3. 教材管理模块——用于导入教材，建立教材与班级之间的关系，也是下单依据
4. 订购年度模块——用于判断是否开启下单，聚合订单及数据统计
5. 购物车模块——用于合并多本教材进行下单支付
6. 订单模块——用于支持用户购买流程
7. 统计模块——用于保存已统计的订单数据
8. 会员模块——用于会员认证、前台权限判断

### 业务流程设计

#### 教材信息维护

1. 教材信息数据量极大，我们将采用导入 ISBN 后由接口补全详细信息的方案。首先将征订表 excel 表格按照固定格式整理好，例如只留下 ISBN 一列。后通过程序导入 excel，首次导入会根据 ISBN 接口补全书本详细信息，例如名称、作者、出版社、售价等。之后导入会比对数据库原有信息，对书教材据库进行补充。
2. 由于教材数据是重复使用的，所以不保存对应课程及主讲教师等信息。在课本与班级关联的操作时补充这部分信息。
3. 教材数据不会随订购年度而改变、作废，无论哪个订购年度，无论哪个学校都使用相同的教材数据。这也意味着价格是相同的。可以在原有接口获取到的价格的基础上自定义售价，用户以售价进行购买，但是无法针对某个学校单独定价。
4. 教材信息会记录到订单中，即便下单之后教材信息有修改，订单仍然按照下单瞬间的信息进行付款。在开放购买之前需要检查好教材信息。
5. 在教材和班级的关联中还需要具备订购年度的概念，即不同的订购年度，同一个班级所关联的教材是不同的。这也需要管理员在每次订购之前`人工添加并核查`。
6. 书本封面可以让整个网站更加美观，我们直接使用 ISBN 接口所返回的远程图片地址。项目中不保存教材图片。
7. 接口价格大约为两分钱一次

#### 学校信息维护

1. 学校数据将会与二手书部分共用

#### 班级信息维护

1. 班级信息由管理员`手动添加`，添加时首先选择学校，班级信息采用自为上下级的数据结构，上级为学院信息，下级为班级信息，甚至可以再精细到下下级，这样就可以灵活的管理层级。
2. 书本可以关联到任意层级，关联到上级的教材会向下兼容展示。例如教材 A 关联到学院 X，用户所属的层级为学院 X 下的 m 班，此时用户不仅能够看到关联到学院 X 的教材，同时也能看到关联到 m 班的教材。在某种程度上这样的设计可以减少管理员维护教材关系的工作量。
3. `班级与教材为多对多关系`，建立关系时需要补充课程及教师信息，以供用户在选择时参考。多对多的关系将对数据库造成较大压力，如果后期速度太慢就得进行数据缓存处理，甚至数据量达到量变引起质变（例如五万人同时使用），我们将对系统进行更深层的优化。`这部分的实现方案对价格成本有很大的影响`。
4. 现实中班级存在两个概念：入学年份、班次，一般会使用3~4位数字表示，例如：“电器151”代表电气专业、2015级、1班。他们在系统中的表现形式为`上下级`。例如：电器工程学院-电器专业-2015级-1班，就是一个典型的 4 级结构。
5. 班级与用户的关系为一个班级拥有多个用户，而一个用户只能关联到一个班级。此处的班级代表的其实是层级，而且必须是叶子层级。例如：某专业2015级只有一个班，那么用户就关联到2015级，如果2015级存在下级1班、2班，那么用户必须选择到最后一级。
6. 用户最终可供订购的教材取决于用户所在的层级，例如：电器学院关联了3本教材，电器专业关联了10本教材，1班关联了2本教材，那么用户最终能够看到的教材数量为3+10+2=15本。
7. 用户在首次关联班级之后，即便订购年度发生变化，也不需要改变自己所属班级。令教材发生变化的是教材和班级之间的关联。
8. 已经失去意义的班级，可以由管理员`手动删除`

#### 订购年度维护

1. 订购年度有两个作用，一个是用来管理教材-班级关系，另一个是用于框定订单统计范围。在没有订购年度的情况下，可以存在教材，也可以存在班级，但是班级和教材无法关联。每一个订购年度的教材-班级关系都需要`重新维护`。没有订购年度也不会产生订单。
2. 订购年度属于某个学校，一个学校可以有多个订购年度，同一时间只能够启用一个。

#### 购物车

1. 购物车中默认摆放了所有可选购教材，用户只需要勾选即可，数量默认为1不可改。作为一个工具类应用，我们尽量简化用户的使用流程。
2. 在没有订购年度可用的情况下，用户可以查看购物车中的内容，但是无法下单。

#### 订单

1. 在购物车中选择完之后将会产生订单等待用户支付，订单状态有：待付款、待取书、已完成、已取消。取书之后由用户进行确认。如果流程终于到问题可由管理员将订单调为已取消状态。
2. 订单筛选方式有：按照学校、按照班级、按照 ISBN

#### 统计模块

1. 根据学校列出订书单，包括ISBN、书名、订购人、订购人电话、使用班级、订购数量等
2. 根据班级（或其他层级）列出订书单，包括ISBN、书名、订购人、订购人电话、使用班级、订购数量等
3. 根据唯一书本名称，或者 ISBN 列出订书单，包括ISBN、书名、订购人、订购人电话、使用班级、订购数量等

#### 会员模块

1. 继续使用二手书的会员模块
2. 在原有基础上，`注册时登记学校信息，订购教材之前选择班级`



确认人：

确认时间：